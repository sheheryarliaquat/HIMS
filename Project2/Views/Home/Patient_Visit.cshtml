@model Project2.Models.TBL_R_RECEIPT

@{
ViewBag.Title = "SLIP";
//Layout = "~/Views/Shared/_Layout.cshtml";
Layout = null;
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

@using (Html.BeginForm("Patient_Visit", "Home", FormMethod.Post))
{
    @Html.AntiForgeryToken()


    <div class="form-horizontal" >
        <form id="form">

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.MR_NO, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.MR_NO, new { htmlAttributes = new { @class = "form-control", id = "MR" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.MR_NO, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.TEL_NO, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.TEL_NO, new { htmlAttributes = new { @class = "form-control", id = "telNo" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.TEL_NO, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">

                                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModal" id="search"><i class="fa fa-search"></i> Search</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.FIRST_NAME, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.FIRST_NAME, new { htmlAttributes = new { @class = "form-control", id = "name" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.FIRST_NAME, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.F_NAME, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.F_NAME, new { htmlAttributes = new { @class = "form-control", id = "fname" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.F_NAME, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                               
                            </div>
                            <div class="row">

                                <div class="col-md-2">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.AGE, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.AGE, new { htmlAttributes = new { @class = "form-control", id = "age" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.AGE, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.DATEOFBIRTH, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.DATEOFBIRTH, new { htmlAttributes = new { @class = "form-control", id = "dob" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.DATEOFBIRTH, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.GENDER, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.DropDownListFor(model => model.TBL_R_PATIENT.GENDER, ViewBag.gendr as SelectList, "..Select Gender..", new { @class = "form-control", id = "gender" })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.GENDER, "", new { @class = "text-danger" })

                                    </div>
                                </div>

                            </div>
                            <div class="row">


                                <div class="col-md-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.CNIC_NO, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.CNIC_NO, new { htmlAttributes = new { @class = "form-control", id = "nic" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.CNIC_NO, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.TBL_R_PATIENT.ADDRESS1, htmlAttributes: new { @class = "bmd-label-floating" })
                                        @Html.EditorFor(model => model.TBL_R_PATIENT.ADDRESS1, new { htmlAttributes = new { @class = "form-control", id = "address" } })
                                        @Html.ValidationMessageFor(model => model.TBL_R_PATIENT.ADDRESS1, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="card">
                            <div class="card-body">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.DEPT_ID, htmlAttributes: new { @class = "bmd-label-floating" })
                                            @Html.DropDownListFor(model => model.DEPT_ID, ViewBag.departments as SelectList, "..Select Departments..", new { @class = "form-control", id = "dept" })
                                            @Html.ValidationMessageFor(model => model.DEPT_ID, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.CONSULTANT_ID, htmlAttributes: new { @class = "bmd-label-floating" })
                                            @Html.DropDownListFor(model => model.CONSULTANT_ID, ViewBag.consultants as SelectList, "..Select Consultants..", new { @class = "form-control", id = "cons" })
                                            @Html.ValidationMessageFor(model => model.CONSULTANT_ID, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.PAYMENT_AMOUNT, htmlAttributes: new { @class = "bmd-label-floating" })
                                            @Html.DropDownListFor(model => model.PAYMENT_AMOUNT, ViewBag.consultants as SelectList, "..Select Consultants..", new { @class = "form-control", id = "FEE" })
                                            @Html.ValidationMessageFor(model => model.PAYMENT_AMOUNT, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                </div>
                                
                                
                                <div class="form-group">
                                    <div class="col-md-offset-2 col-md-10">
                                        <input type="submit" value="Save" class="btn btn-success" />
                                        <input type="submit" value="Cancel" class="btn btn-danger" />

                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

               

            </div>
            <div id="myModal" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Modal Header</h4>
                        </div>
                        <div class="modal-body">
                            <select class="Country" style="width:400px" multiple>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal" id="save">Confirm</button>
                        </div>
                    </div>

                </div>
            </div>
        </form>
    </div>



}



<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function ()
    {
        $(".Country").select2({
                placeholder: "Conatact Number ",
                theme: "classic",
                ajax:
                {

                    url: '/Home/PatientData',
                    dataType: 'json',
                    data: function (params)
                    {
                        return {
                            searchTerm: params.term
                        };
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                }
            });
        $("#dept").change(function ()
            {
                 var dp = $("#dept").val();

                $.ajax({
                    url: "/Home/GetConsultant?DEP=" + dp,
                    method: "POST",
                    datatype: "json",
                    success: function (data)
                    {
                        var s = '<option value="-1">Select a Department</option>';  
                   for (var i = 0; i < data.length; i++) {  
                       s += '<option value="' + data[i].Id + '">' + data[i].Name + '</option>';  
                   }  
                   $("#cons").html(s);
                    },
                    error: function (err) { console.error(err) }
                });
      
            });
        $("#cons").change(function ()
                  {
                      console.log("1");
                    var fee = $("#cons").val();
                $.ajax({
                    url: "/Home/GetConsultantFee?con=" + fee,
                    method: "POST",
                    datatype: "json",
                    success: function (data)
                    {
                        console.log(data);
                    
                        var s = '<option value="-1">Select a Consultant</option>';  
                   for (var i = 0; i < data.length; i++) {  
                       s += '<option value="' + data[i].fee + '">' + data[i].fee + '</option>';  
                   }  
                   $("#FEE").html(s);
                    },
                    error: function (err) { console.error(err) }
                });
        });
        $("#age").change(function ()
        {
            var ag = $('#age').val();
            var date = new Date();
           $("#dob").val((date.getMonth()) + '/' + (date.getDate() ) + '/' + (date.getFullYear() -ag));
        });
        $("#MR").change(function ()
        {
            
            var mr = $("#MR").val();
           
            $.ajax({
                url: "/Home/getDatapatient?MRNO=" + mr,
                method: "POST",
                datatype: "json",
                success: function (data)
                {
                    var data = JSON.parse(data);
                    alert(data);
                    $(".FFname").text(data[0].Name);
                    document.getElementById("name").value = (data[0].name);
                    document.getElementById("fname").value = (data[0].fname);
                    document.getElementById("telNo").value = (data[0].telno);
                    document.getElementById("gn").value = (data[0].gn);
                    document.getElementById("nic").value = (data[0].nic);
                    document.getElementById("dob").value = (data[0].dob);
                    $(".telNo").text(data.Name);
                },
                error: function (err) { console.error(err) }
            });

        });

    });
         $("#save").click(function ()
            {
        
                var mr = $(".Country").val();
                $.ajax({
                    url: "/Home/getDatapatient?MRNO=" + mr,
                    method: "POST",
                    datatype: "json",
                    success: function (data)
                    {

                        //var data = JSON.parse(data);
                        console.log(data);
                        //$(".FFname").text(data[0].Name);
                        document.getElementById("name").value = (data[0].name);
                        document.getElementById("fname").value = (data[0].fname);
                        document.getElementById("telNo").value = (data[0].telno);
                
                        document.getElementById("gn").value = (data[0].gn);
                        document.getElementById("nic").value = (data[0].nic);
                        document.getElementById("dob").value = (data[0].dob);
                
                        //$(".telNo").text(data.Name);
                    },
                    error: function (err) { console.error(err) }
                })
            });
         $("#search").click(function ()
            {
                 document.getElementById("name").value = "";
                        document.getElementById("fname").value = "";
                        document.getElementById("telNo").value = "";
                        document.getElementById("dob").value = "";
                        document.getElementById("gn").value = "";
                 document.getElementById("nic").value = "";

         });
    $("#MR").change(function ()
        {
            
            var mr = $("#MR").val();
           
            $.ajax({
                url: "/Home/getDatapatient?MRNO=" + mr,
                method: "POST",
                datatype: "json",
                success: function (data)
                {
                    //alert("1");
                    //var data = JSON.parse(data);
                    //$(".FFname").text(data[0].Name);
                    document.getElementById("MR").value = (data[0].id);
                    document.getElementById("name").value = (data[0].name);
                    document.getElementById("fname").value = (data[0].fname);
                    document.getElementById("telNo").value = (data[0].telno);
                    document.getElementById("nic").value = (data[0].nic);
                    document.getElementById("dob").value = (data[0].dob);
                    document.getElementById("age").value = (data[0].age);
                    document.getElementById("gn").value = (data[0].gn);
                    $(".telNo").text(data.Name);
                },
                error: function (err) { console.error(err) }
            });

        });
    
</script>
